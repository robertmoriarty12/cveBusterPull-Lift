{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "metadata": {
    "author": "cveBuster - support@cvebuster.com",
    "comments": "Solution template for cveBuster Vulnerability Scanning"
  },
  "parameters": {
    "location": {
      "type": "string",
      "minLength": 1,
      "defaultValue": "[resourceGroup().location]",
      "metadata": {
        "description": "Not used, but needed to pass arm-ttk test `Location-Should-Not-Be-Hardcoded`.  We instead use the `workspace-location` which is derived from the LA workspace"
      }
    },
    "workspace-location": {
      "type": "string",
      "defaultValue": "",
      "metadata": {
        "description": "[concat('Region to deploy solution resources -- separate from location selection',parameters('location'))]"
      }
    },
    "workspace": {
      "defaultValue": "",
      "type": "string",
      "metadata": {
        "description": "Workspace name for Log Analytics where Microsoft Sentinel is setup"
      }
    },
    "resourceGroupName": {
      "type": "string",
      "defaultValue": "[resourceGroup().name]",
      "metadata": {
        "description": "resource group name where Microsoft Sentinel is setup"
      }
    },
    "subscription": {
      "type": "string",
      "defaultValue": "[last(split(subscription().id, '/'))]",
      "metadata": {
        "description": "subscription id where Microsoft Sentinel is setup"
      }
    },
    "workbook1-name": {
      "type": "string",
      "defaultValue": "cveBuster Vulnerability Scanner Dashboard",
      "minLength": 1,
      "metadata": {
        "description": "Name for the workbook"
      }
    }
  },
  "variables": {
    "email": "support@cvebuster.com",
    "_email": "[variables('email')]",
    "_solutionName": "cveBuster Vulnerability Scanning",
    "_solutionVersion": "3.0.0",
    "solutionId": "cvebuster.cvebuster-sentinel-solution",
    "_solutionId": "[variables('solutionId')]",
    "workspaceResourceId": "[resourceId('microsoft.OperationalInsights/Workspaces', parameters('workspace'))]",
    "dataConnectorCCPVersion": "1.0.0",
    "_dataConnectorContentIdConnectorDefinition1": "cveBusterVulnerabilitiesConnector",
    "dataConnectorTemplateNameConnectorDefinition1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnectorDefinition1')))]",
    "_dataConnectorContentIdConnections1": "cveBusterVulnerabilitiesConnectorConnections",
    "dataConnectorTemplateNameConnections1": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnections1')))]",
    "dataCollectionEndpointId1": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]",
    "blanks": "[replace('b', 'b', '')]",
    "_dataConnectorContentIdConnectorDefinition2": "cveBusterVulnerabilitiesPushConnector",
    "dataConnectorTemplateNameConnectorDefinition2": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnectorDefinition2')))]",
    "_dataConnectorContentIdConnections2": "cveBusterVulnerabilitiesPushConnectorConnections",
    "dataConnectorTemplateNameConnections2": "[concat(parameters('workspace'),'-dc-',uniquestring(variables('_dataConnectorContentIdConnections2')))]",
    "dataCollectionEndpointId2": "[concat('/subscriptions/',parameters('subscription'),'/resourceGroups/',parameters('resourceGroupName'),'/providers/Microsoft.Insights/dataCollectionEndpoints/',parameters('workspace'))]",
    "workbookVersion1": "1.0.0",
    "workbookContentId1": "cveBusterWorkbook",
    "workbookId1": "[resourceId('Microsoft.Insights/workbooks', variables('workbookContentId1'))]",
    "workbookTemplateSpecName1": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat(parameters('workspace'),'-wb-',uniquestring(variables('_workbookContentId1'))))]",
    "_workbookContentId1": "[variables('workbookContentId1')]",
    "_workbookcontentProductId1": "[concat(take(variables('_solutionId'),50),'-','wb','-', uniqueString(concat(variables('_solutionId'),'-','Workbook','-',variables('_workbookContentId1'),'-', variables('workbookVersion1'))))]",
    "_solutioncontentProductId": "[concat(take(variables('_solutionId'),50),'-','sl','-', uniqueString(concat(variables('_solutionId'),'-','Solution','-',variables('_solutionId'),'-', variables('_solutionVersion'))))]"
  },
  "resources": [
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnectorDefinition1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "displayName": "cveBuster Vulnerability Scanner",
        "contentKind": "DataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
              "apiVersion": "2022-09-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
              "location": "[parameters('workspace-location')]",
              "kind": "Customizable",
              "properties": {
                "connectorUiConfig": {
                  "id": "cveBusterVulnerabilitiesConnector",
                  "title": "cveBuster Vulnerability Scanner",
                  "publisher": "cveBuster",
                  "descriptionMarkdown": "The cveBuster data connector provides automated ingestion of vulnerability scan data from your cveBuster API into Microsoft Sentinel. This connector uses the Codeless Connector Framework (CCF) with REST API polling to continuously fetch vulnerability information including CVE details, CVSS scores, patch availability, exploit intelligence, and asset criticality. Data is ingested into a custom Log Analytics table for analysis, alerting, and visualization.",
                  "graphQueriesTableName": "cveBusterVulnerabilities_CL",
                  "graphQueries": [
                    {
                      "metricName": "Total vulnerability records",
                      "legend": "cveBuster Vulnerabilities",
                      "baseQuery": "{{graphQueriesTableName}}"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All vulnerability records",
                      "query": "{{graphQueriesTableName}}\n| take 10"
                    },
                    {
                      "description": "Critical vulnerabilities with active exploits",
                      "query": "{{graphQueriesTableName}}\n| where Severity == 'Critical' and ExploitAvailable == true\n| project TimeGenerated, MachineName, VulnId, VulnTitle, CVSS, ExploitedInWild"
                    },
                    {
                      "description": "Vulnerability count by severity",
                      "query": "{{graphQueriesTableName}}\n| summarize Count=count() by Severity\n| render piechart"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "{{graphQueriesTableName}}",
                      "lastDataReceivedQuery": "{{graphQueriesTableName}}\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "HasDataConnectors",
                      "value": null
                    }
                  ],
                  "availability": {
                    "isPreview": true
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "Read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "cveBuster API Access",
                        "description": "An API key with read access to the cveBuster vulnerability scanning API is required."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "title": "Configure Connection",
                      "description": "Enter your cveBuster API endpoint and authentication key. The connector will poll the API every 5 minutes.",
                      "instructions": [
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "API Endpoint URL",
                            "placeholder": "http://20.84.144.179:5000/api/vulnerabilities",
                            "name": "apiEndpoint"
                          }
                        },
                        {
                          "type": "Textbox",
                          "parameters": {
                            "label": "API Key",
                            "placeholder": "Enter your API key",
                            "name": "apiKey"
                          }
                        },
                        {
                          "type": "ConnectionToggleButton",
                          "parameters": {}
                        }
                      ]
                    }
                  ]
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "cveBuster",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Your Company Support",
                  "email": "support@yourcompany.com",
                  "tier": "Partner",
                  "link": "https://yourcompany.com/support"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "version": "[variables('dataConnectorCCPVersion')]",
                      "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                      "kind": "ResourcesDataConnector"
                    }
                  ]
                }
              }
            },
            {
              "name": "cveBusterVulnerabilitiesDCR",
              "apiVersion": "2022-06-01",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "kind": "[variables('blanks')]",
              "properties": {
                "dataCollectionEndpointId": "[variables('dataCollectionEndpointId1')]",
                "streamDeclarations": {
                  "Custom-cveBusterVulnerabilitiesStream": {
                    "columns": [
                      {
                        "name": "MachineName",
                        "type": "string"
                      },
                      {
                        "name": "HostId",
                        "type": "string"
                      },
                      {
                        "name": "IPAddress",
                        "type": "string"
                      },
                      {
                        "name": "OSFamily",
                        "type": "string"
                      },
                      {
                        "name": "Application",
                        "type": "string"
                      },
                      {
                        "name": "AppFilePath",
                        "type": "string"
                      },
                      {
                        "name": "VulnId",
                        "type": "string"
                      },
                      {
                        "name": "VulnTitle",
                        "type": "string"
                      },
                      {
                        "name": "Severity",
                        "type": "string"
                      },
                      {
                        "name": "CVSS",
                        "type": "real"
                      },
                      {
                        "name": "ExploitAvailable",
                        "type": "boolean"
                      },
                      {
                        "name": "ExploitedInWild",
                        "type": "boolean"
                      },
                      {
                        "name": "PatchAvailable",
                        "type": "boolean"
                      },
                      {
                        "name": "FirstSeen",
                        "type": "datetime"
                      },
                      {
                        "name": "LastSeen",
                        "type": "datetime"
                      },
                      {
                        "name": "LastScanTime",
                        "type": "datetime"
                      },
                      {
                        "name": "AssetCriticality",
                        "type": "string"
                      },
                      {
                        "name": "BusinessOwner",
                        "type": "string"
                      },
                      {
                        "name": "Source",
                        "type": "string"
                      }
                    ]
                  }
                },
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "Custom-cveBusterVulnerabilitiesStream"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source | extend TimeGenerated = now()",
                    "outputStream": "Custom-cveBusterVulnerabilities_CL"
                  }
                ]
              }
            },
            {
              "name": "cveBusterVulnerabilities_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "cveBusterVulnerabilities_CL",
                  "tableType": "CustomLog",
                  "description": "cveBuster vulnerability scan data containing CVE details, asset information, patch status, and exploit intelligence",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": true,
                      "description": "The timestamp when the data was ingested into Sentinel"
                    },
                    {
                      "name": "MachineName",
                      "type": "string",
                      "isDefaultDisplay": true,
                      "description": "Hostname of the scanned machine"
                    },
                    {
                      "name": "HostId",
                      "type": "string",
                      "description": "Unique identifier for the host (GUID format)"
                    },
                    {
                      "name": "IPAddress",
                      "type": "string",
                      "description": "IP address of the scanned machine"
                    },
                    {
                      "name": "OSFamily",
                      "type": "string",
                      "description": "Operating system family (Windows/Linux/macOS)"
                    },
                    {
                      "name": "Application",
                      "type": "string",
                      "isDefaultDisplay": true,
                      "description": "Name of the vulnerable application"
                    },
                    {
                      "name": "AppFilePath",
                      "type": "string",
                      "description": "File path of the vulnerable application"
                    },
                    {
                      "name": "VulnId",
                      "type": "string",
                      "isDefaultDisplay": true,
                      "description": "CVE identifier (e.g., CVE-2024-1234)"
                    },
                    {
                      "name": "VulnTitle",
                      "type": "string",
                      "isDefaultDisplay": true,
                      "description": "Vulnerability title/description"
                    },
                    {
                      "name": "Severity",
                      "type": "string",
                      "isDefaultDisplay": true,
                      "description": "Vulnerability severity level (Critical/High/Medium/Low)"
                    },
                    {
                      "name": "CVSS",
                      "type": "real",
                      "isDefaultDisplay": true,
                      "description": "CVSS score (0.0-10.0)"
                    },
                    {
                      "name": "ExploitAvailable",
                      "type": "boolean",
                      "description": "Whether a public exploit is available for this vulnerability"
                    },
                    {
                      "name": "ExploitedInWild",
                      "type": "boolean",
                      "description": "Whether active exploitation has been detected"
                    },
                    {
                      "name": "PatchAvailable",
                      "type": "boolean",
                      "description": "Whether a patch is available from the vendor"
                    },
                    {
                      "name": "FirstSeen",
                      "type": "datetime",
                      "description": "First time this vulnerability was detected on the asset"
                    },
                    {
                      "name": "LastSeen",
                      "type": "datetime",
                      "description": "Last time this vulnerability was detected"
                    },
                    {
                      "name": "LastScanTime",
                      "type": "datetime",
                      "description": "Most recent scan timestamp for this asset"
                    },
                    {
                      "name": "AssetCriticality",
                      "type": "string",
                      "description": "Business criticality of the asset (Critical/High/Medium/Low)"
                    },
                    {
                      "name": "BusinessOwner",
                      "type": "string",
                      "description": "Team or department responsible for the asset"
                    },
                    {
                      "name": "Source",
                      "type": "string",
                      "description": "Data source identifier (always 'cveBuster')"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentIdConnectorDefinition1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition1'))]",
      "apiVersion": "2022-09-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
      "location": "[parameters('workspace-location')]",
      "kind": "Customizable",
      "properties": {
        "connectorUiConfig": {
          "id": "cveBusterVulnerabilitiesConnector",
          "title": "cveBuster Vulnerability Scanner",
          "publisher": "cveBuster",
          "descriptionMarkdown": "The cveBuster data connector provides automated ingestion of vulnerability scan data from your cveBuster API into Microsoft Sentinel. This connector uses the Codeless Connector Framework (CCF) with REST API polling to continuously fetch vulnerability information including CVE details, CVSS scores, patch availability, exploit intelligence, and asset criticality. Data is ingested into a custom Log Analytics table for analysis, alerting, and visualization.",
          "graphQueriesTableName": "cveBusterVulnerabilities_CL",
          "graphQueries": [
            {
              "metricName": "Total vulnerability records",
              "legend": "cveBuster Vulnerabilities",
              "baseQuery": "{{graphQueriesTableName}}"
            }
          ],
          "sampleQueries": [
            {
              "description": "All vulnerability records",
              "query": "{{graphQueriesTableName}}\n| take 10"
            },
            {
              "description": "Critical vulnerabilities with active exploits",
              "query": "{{graphQueriesTableName}}\n| where Severity == 'Critical' and ExploitAvailable == true\n| project TimeGenerated, MachineName, VulnId, VulnTitle, CVSS, ExploitedInWild"
            },
            {
              "description": "Vulnerability count by severity",
              "query": "{{graphQueriesTableName}}\n| summarize Count=count() by Severity\n| render piechart"
            }
          ],
          "dataTypes": [
            {
              "name": "{{graphQueriesTableName}}",
              "lastDataReceivedQuery": "{{graphQueriesTableName}}\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "HasDataConnectors",
              "value": null
            }
          ],
          "availability": {
            "isPreview": true
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "Read and Write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "Read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ],
            "customs": [
              {
                "name": "cveBuster API Access",
                "description": "An API key with read access to the cveBuster vulnerability scanning API is required."
              }
            ]
          },
          "instructionSteps": [
            {
              "title": "Configure Connection",
              "description": "Enter your cveBuster API endpoint and authentication key. The connector will poll the API every 5 minutes.",
              "instructions": [
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "API Endpoint URL",
                    "placeholder": "http://20.84.144.179:5000/api/vulnerabilities",
                    "name": "apiEndpoint"
                  }
                },
                {
                  "type": "Textbox",
                  "parameters": {
                    "label": "API Key",
                    "placeholder": "Enter your API key",
                    "name": "apiKey"
                  }
                },
                {
                  "type": "ConnectionToggleButton",
                  "parameters": {}
                }
              ]
            }
          ]
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition1')))]",
      "apiVersion": "2022-01-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition1'))]",
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition1')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorCCPVersion')]",
        "source": {
          "sourceId": "[variables('_solutionId')]",
          "name": "[variables('_solutionName')]",
          "kind": "Solution"
        },
        "author": {
          "name": "cveBuster",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Your Company Support",
          "email": "support@yourcompany.com",
          "tier": "Partner",
          "link": "https://yourcompany.com/support"
        },
        "dependencies": {
          "criteria": [
            {
              "version": "[variables('dataConnectorCCPVersion')]",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "kind": "ResourcesDataConnector"
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnections1'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnections1')]",
        "displayName": "cveBuster Vulnerability Scanner",
        "contentKind": "ResourcesDataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {
            "guidValue": {
              "defaultValue": "[[newGuid()]",
              "type": "securestring"
            },
            "innerWorkspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "connectorDefinitionName": {
              "defaultValue": "cveBuster Vulnerability Scanner",
              "type": "securestring",
              "minLength": 1
            },
            "workspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "dcrConfig": {
              "defaultValue": {
                "dataCollectionEndpoint": "data collection Endpoint",
                "dataCollectionRuleImmutableId": "data collection rule immutableId"
              },
              "type": "object"
            },
            "apiEndpoint": {
              "defaultValue": "apiEndpoint",
              "type": "securestring",
              "minLength": 1
            },
            "apiKey": {
              "defaultValue": "apiKey",
              "type": "securestring",
              "minLength": 1
            }
          },
          "variables": {
            "_dataConnectorContentIdConnections1": "[variables('_dataConnectorContentIdConnections1')]"
          },
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnections1')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentIdConnections1'))]",
                "contentId": "[variables('_dataConnectorContentIdConnections1')]",
                "kind": "ResourcesDataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "cveBuster",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Your Company Support",
                  "email": "support@yourcompany.com",
                  "tier": "Partner",
                  "link": "https://yourcompany.com/support"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'cveBusterVulnerabilitiesPoller', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "RestApiPoller",
              "properties": {
                "connectorDefinitionName": "cveBusterVulnerabilitiesConnector",
                "dcrConfig": {
                  "streamName": "Custom-cveBusterVulnerabilitiesStream",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "dataType": "cveBuster Vulnerabilities",
                "auth": {
                  "type": "APIKey",
                  "ApiKey": "[[parameters('apiKey')]",
                  "ApiKeyName": "Authorization"
                },
                "request": {
                  "apiEndpoint": "[[parameters('apiEndpoint')]",
                  "rateLimitQPS": 10,
                  "queryWindowInMin": 5,
                  "httpMethod": "GET",
                  "queryTimeFormat": "yyyy-MM-ddTHH:mm:ssZ",
                  "startTimeAttributeName": "createdAt__gt",
                  "endTimeAttributeName": "createdAt__lt",
                  "retryCount": 3,
                  "timeoutInSeconds": 60,
                  "headers": {
                    "Accept": "application/json",
                    "User-Agent": "cveBuster"
                  }
                },
                "paging": {
                  "pagingType": "NextPageToken",
                  "nextPageTokenJsonPath": "$.next_token",
                  "NextPageParaName": "next_token",
                  "PageSize": "50",
                  "PageSizeParameterName": "page_size"
                },
                "response": {
                  "eventsJsonPaths": [
                    "$.data"
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','rdc','-', uniqueString(concat(variables('_solutionId'),'-','ResourcesDataConnector','-',variables('_dataConnectorContentIdConnections1'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnectorDefinition2'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition2')]",
        "displayName": "cveBuster Vulnerability Scanner (Push)",
        "contentKind": "DataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition2'))]",
              "apiVersion": "2022-09-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
              "location": "[parameters('workspace-location')]",
              "kind": "Customizable",
              "properties": {
                "connectorUiConfig": {
                  "id": "cveBusterVulnerabilitiesPushConnector",
                  "title": "cveBuster Vulnerability Scanner (Push)",
                  "publisher": "cveBuster",
                  "descriptionMarkdown": "The cveBuster Push data connector enables real-time vulnerability data ingestion into Microsoft Sentinel. Your vulnerability scanning application pushes data directly to Azure using the Azure Monitor Ingestion API with Service Principal authentication. This eliminates the need for API polling and provides near-instant visibility into newly discovered vulnerabilities.",
                  "graphQueriesTableName": "cveBusterVulnerabilities_CL",
                  "graphQueries": [
                    {
                      "metricName": "Total vulnerability records",
                      "legend": "cveBuster Vulnerabilities (Push)",
                      "baseQuery": "{{graphQueriesTableName}}"
                    }
                  ],
                  "sampleQueries": [
                    {
                      "description": "All vulnerability records",
                      "query": "{{graphQueriesTableName}}\n| take 10"
                    },
                    {
                      "description": "Critical vulnerabilities with active exploits",
                      "query": "{{graphQueriesTableName}}\n| where Severity == 'Critical' and ExploitAvailable == true\n| project TimeGenerated, MachineName, VulnId, VulnTitle, CVSS"
                    },
                    {
                      "description": "Recent vulnerabilities (last hour)",
                      "query": "{{graphQueriesTableName}}\n| where TimeGenerated > ago(1h)\n| summarize Count=count() by Severity\n| render piechart"
                    }
                  ],
                  "dataTypes": [
                    {
                      "name": "{{graphQueriesTableName}}",
                      "lastDataReceivedQuery": "{{graphQueriesTableName}}\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
                    }
                  ],
                  "connectivityCriteria": [
                    {
                      "type": "HasDataConnectors",
                      "value": null
                    }
                  ],
                  "availability": {
                    "isPreview": true
                  },
                  "permissions": {
                    "resourceProvider": [
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces",
                        "permissionsDisplayText": "Read and Write permissions are required.",
                        "providerDisplayName": "Workspace",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "write": true,
                          "read": true,
                          "delete": true
                        }
                      },
                      {
                        "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                        "permissionsDisplayText": "Read permissions to shared keys for the workspace are required.",
                        "providerDisplayName": "Keys",
                        "scope": "Workspace",
                        "requiredPermissions": {
                          "action": true
                        }
                      }
                    ],
                    "customs": [
                      {
                        "name": "Azure Service Principal",
                        "description": "A Service Principal with Monitoring Metrics Publisher role on the Data Collection Rule is required for authentication."
                      }
                    ]
                  },
                  "instructionSteps": [
                    {
                      "title": "1. Deploy Push Connector Resources",
                      "description": "Click the button below to deploy Azure resources required for CCF Push ingestion. This creates a Service Principal, Data Collection Endpoint (DCE), Data Collection Rule (DCR), and custom Log Analytics table.",
                      "instructions": [
                        {
                          "type": "Markdown",
                          "parameters": {
                            "content": "#### Automated Configuration and Secure Data Ingestion with Entra Application\nClicking on **Deploy** will trigger the creation of Log Analytics tables and a Data Collection Rule (DCR). It will then create an Entra application, link the DCR to it, and set the entered secret in the application. This setup enables data to be sent securely to the DCR using an Entra token."
                          }
                        },
                        {
                          "parameters": {
                            "label": "Deploy cveBuster connector resources",
                            "applicationDisplayName": "cveBuster Vulnerability Scanner Application"
                          },
                          "type": "DeployPushConnectorButton"
                        }
                      ]
                    },
                    {
                      "title": "2. Configure Your Application",
                      "description": "After deployment, use the following parameters to configure your vulnerability scanner to push data to the workspace:",
                      "instructions": [
                        {
                          "type": "CopyableLabel",
                          "parameters": {
                            "label": "Tenant ID (Directory ID)",
                            "fillWith": [
                              "TenantId"
                            ]
                          }
                        },
                        {
                          "type": "CopyableLabel",
                          "parameters": {
                            "label": "Application (Client) ID",
                            "fillWith": [
                              "ApplicationId"
                            ],
                            "placeholder": "Deploy push connector to get the Application ID"
                          }
                        },
                        {
                          "type": "CopyableLabel",
                          "parameters": {
                            "label": "Application Secret",
                            "fillWith": [
                              "ApplicationSecret"
                            ],
                            "placeholder": "Deploy push connector to get the Application Secret"
                          }
                        },
                        {
                          "type": "CopyableLabel",
                          "parameters": {
                            "label": "Data Collection Endpoint",
                            "fillWith": [
                              "DataCollectionEndpoint"
                            ],
                            "placeholder": "Deploy push connector to get the Data Collection Endpoint"
                          }
                        },
                        {
                          "type": "CopyableLabel",
                          "parameters": {
                            "label": "Data Collection Rule Immutable ID",
                            "fillWith": [
                              "DataCollectionRuleId"
                            ],
                            "placeholder": "Deploy push connector to get the Data Collection Rule ID"
                          }
                        },
                        {
                          "type": "CopyableLabel",
                          "parameters": {
                            "label": "Stream Name",
                            "value": "Custom-cveBusterVulnerabilities"
                          }
                        }
                      ]
                    }
                  ]
                }
              }
            },
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition2')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition2'))]",
                "contentId": "[variables('_dataConnectorContentIdConnectorDefinition2')]",
                "kind": "DataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "cveBuster",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Your Company Support",
                  "email": "support@yourcompany.com",
                  "tier": "Partner",
                  "link": "https://yourcompany.com/support"
                },
                "dependencies": {
                  "criteria": [
                    {
                      "version": "[variables('dataConnectorCCPVersion')]",
                      "contentId": "[variables('_dataConnectorContentIdConnections2')]",
                      "kind": "ResourcesDataConnector"
                    }
                  ]
                }
              }
            },
            {
              "name": "cveBusterVulnerabilitiesPushDCR",
              "apiVersion": "2022-06-01",
              "type": "Microsoft.Insights/dataCollectionRules",
              "location": "[parameters('workspace-location')]",
              "kind": "[variables('blanks')]",
              "properties": {
                "dataCollectionEndpointId": "[variables('dataCollectionEndpointId2')]",
                "streamDeclarations": {
                  "Custom-cveBusterVulnerabilities": {
                    "columns": [
                      {
                        "name": "MachineName",
                        "type": "string"
                      },
                      {
                        "name": "HostId",
                        "type": "string"
                      },
                      {
                        "name": "IPAddress",
                        "type": "string"
                      },
                      {
                        "name": "OSFamily",
                        "type": "string"
                      },
                      {
                        "name": "Application",
                        "type": "string"
                      },
                      {
                        "name": "AppFilePath",
                        "type": "string"
                      },
                      {
                        "name": "VulnId",
                        "type": "string"
                      },
                      {
                        "name": "VulnTitle",
                        "type": "string"
                      },
                      {
                        "name": "Severity",
                        "type": "string"
                      },
                      {
                        "name": "CVSS",
                        "type": "real"
                      },
                      {
                        "name": "ExploitAvailable",
                        "type": "boolean"
                      },
                      {
                        "name": "ExploitedInWild",
                        "type": "boolean"
                      },
                      {
                        "name": "PatchAvailable",
                        "type": "boolean"
                      },
                      {
                        "name": "FirstSeen",
                        "type": "datetime"
                      },
                      {
                        "name": "LastSeen",
                        "type": "datetime"
                      },
                      {
                        "name": "LastScanTime",
                        "type": "datetime"
                      },
                      {
                        "name": "AssetCriticality",
                        "type": "string"
                      },
                      {
                        "name": "BusinessOwner",
                        "type": "string"
                      },
                      {
                        "name": "Source",
                        "type": "string"
                      }
                    ]
                  }
                },
                "destinations": {
                  "logAnalytics": [
                    {
                      "workspaceResourceId": "[variables('workspaceResourceId')]",
                      "name": "clv2ws1"
                    }
                  ]
                },
                "dataFlows": [
                  {
                    "streams": [
                      "Custom-cveBusterVulnerabilities"
                    ],
                    "destinations": [
                      "clv2ws1"
                    ],
                    "transformKql": "source | extend TimeGenerated = now()",
                    "outputStream": "Custom-cveBusterVulnerabilities_CL"
                  }
                ]
              }
            },
            {
              "name": "cveBusterVulnerabilities_CL",
              "apiVersion": "2022-10-01",
              "type": "Microsoft.OperationalInsights/workspaces/tables",
              "location": "[parameters('workspace-location')]",
              "kind": null,
              "properties": {
                "schema": {
                  "name": "cveBusterVulnerabilities_CL",
                  "tableType": "CustomLog",
                  "description": "cveBuster vulnerability scan data containing CVE details, asset information, patch status, and exploit intelligence",
                  "columns": [
                    {
                      "name": "TimeGenerated",
                      "type": "datetime",
                      "isDefaultDisplay": true,
                      "description": "The timestamp when the data was ingested into Sentinel"
                    },
                    {
                      "name": "MachineName",
                      "type": "string",
                      "isDefaultDisplay": true,
                      "description": "Hostname of the scanned machine"
                    },
                    {
                      "name": "HostId",
                      "type": "string",
                      "description": "Unique identifier for the host (GUID format)"
                    },
                    {
                      "name": "IPAddress",
                      "type": "string",
                      "description": "IP address of the scanned machine"
                    },
                    {
                      "name": "OSFamily",
                      "type": "string",
                      "description": "Operating system family (Windows/Linux/macOS)"
                    },
                    {
                      "name": "Application",
                      "type": "string",
                      "isDefaultDisplay": true,
                      "description": "Name of the vulnerable application"
                    },
                    {
                      "name": "AppFilePath",
                      "type": "string",
                      "description": "File path of the vulnerable application"
                    },
                    {
                      "name": "VulnId",
                      "type": "string",
                      "isDefaultDisplay": true,
                      "description": "CVE identifier (e.g., CVE-2024-1234)"
                    },
                    {
                      "name": "VulnTitle",
                      "type": "string",
                      "isDefaultDisplay": true,
                      "description": "Vulnerability title/description"
                    },
                    {
                      "name": "Severity",
                      "type": "string",
                      "isDefaultDisplay": true,
                      "description": "Vulnerability severity level (Critical/High/Medium/Low)"
                    },
                    {
                      "name": "CVSS",
                      "type": "real",
                      "isDefaultDisplay": true,
                      "description": "CVSS score (0.0-10.0)"
                    },
                    {
                      "name": "ExploitAvailable",
                      "type": "boolean",
                      "description": "Whether a public exploit is available for this vulnerability"
                    },
                    {
                      "name": "ExploitedInWild",
                      "type": "boolean",
                      "description": "Whether active exploitation has been detected"
                    },
                    {
                      "name": "PatchAvailable",
                      "type": "boolean",
                      "description": "Whether a patch is available from the vendor"
                    },
                    {
                      "name": "FirstSeen",
                      "type": "datetime",
                      "description": "First time this vulnerability was detected on the asset"
                    },
                    {
                      "name": "LastSeen",
                      "type": "datetime",
                      "description": "Last time this vulnerability was detected"
                    },
                    {
                      "name": "LastScanTime",
                      "type": "datetime",
                      "description": "Most recent scan timestamp for this asset"
                    },
                    {
                      "name": "AssetCriticality",
                      "type": "string",
                      "description": "Business criticality of the asset (Critical/High/Medium/Low)"
                    },
                    {
                      "name": "BusinessOwner",
                      "type": "string",
                      "description": "Team or department responsible for the asset"
                    },
                    {
                      "name": "Source",
                      "type": "string",
                      "description": "Data source identifier (always 'cveBuster')"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','dc','-', uniqueString(concat(variables('_solutionId'),'-','DataConnector','-',variables('_dataConnectorContentIdConnectorDefinition2'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',variables('_dataConnectorContentIdConnectorDefinition2'))]",
      "apiVersion": "2022-09-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectorDefinitions",
      "location": "[parameters('workspace-location')]",
      "kind": "Customizable",
      "properties": {
        "connectorUiConfig": {
          "id": "cveBusterVulnerabilitiesPushConnector",
          "title": "cveBuster Vulnerability Scanner (Push)",
          "publisher": "cveBuster",
          "descriptionMarkdown": "The cveBuster Push data connector enables real-time vulnerability data ingestion into Microsoft Sentinel. Your vulnerability scanning application pushes data directly to Azure using the Azure Monitor Ingestion API with Service Principal authentication. This eliminates the need for API polling and provides near-instant visibility into newly discovered vulnerabilities.",
          "graphQueriesTableName": "cveBusterVulnerabilities_CL",
          "graphQueries": [
            {
              "metricName": "Total vulnerability records",
              "legend": "cveBuster Vulnerabilities (Push)",
              "baseQuery": "{{graphQueriesTableName}}"
            }
          ],
          "sampleQueries": [
            {
              "description": "All vulnerability records",
              "query": "{{graphQueriesTableName}}\n| take 10"
            },
            {
              "description": "Critical vulnerabilities with active exploits",
              "query": "{{graphQueriesTableName}}\n| where Severity == 'Critical' and ExploitAvailable == true\n| project TimeGenerated, MachineName, VulnId, VulnTitle, CVSS"
            },
            {
              "description": "Recent vulnerabilities (last hour)",
              "query": "{{graphQueriesTableName}}\n| where TimeGenerated > ago(1h)\n| summarize Count=count() by Severity\n| render piechart"
            }
          ],
          "dataTypes": [
            {
              "name": "{{graphQueriesTableName}}",
              "lastDataReceivedQuery": "{{graphQueriesTableName}}\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
            }
          ],
          "connectivityCriteria": [
            {
              "type": "HasDataConnectors",
              "value": null
            }
          ],
          "availability": {
            "isPreview": true
          },
          "permissions": {
            "resourceProvider": [
              {
                "provider": "Microsoft.OperationalInsights/workspaces",
                "permissionsDisplayText": "Read and Write permissions are required.",
                "providerDisplayName": "Workspace",
                "scope": "Workspace",
                "requiredPermissions": {
                  "write": true,
                  "read": true,
                  "delete": true
                }
              },
              {
                "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
                "permissionsDisplayText": "Read permissions to shared keys for the workspace are required.",
                "providerDisplayName": "Keys",
                "scope": "Workspace",
                "requiredPermissions": {
                  "action": true
                }
              }
            ],
            "customs": [
              {
                "name": "Azure Service Principal",
                "description": "A Service Principal with Monitoring Metrics Publisher role on the Data Collection Rule is required for authentication."
              }
            ]
          },
          "instructionSteps": [
            {
              "title": "1. Deploy Push Connector Resources",
              "description": "Click the button below to deploy Azure resources required for CCF Push ingestion. This creates a Service Principal, Data Collection Endpoint (DCE), Data Collection Rule (DCR), and custom Log Analytics table.",
              "instructions": [
                {
                  "type": "Markdown",
                  "parameters": {
                    "content": "#### Automated Configuration and Secure Data Ingestion with Entra Application\nClicking on **Deploy** will trigger the creation of Log Analytics tables and a Data Collection Rule (DCR). It will then create an Entra application, link the DCR to it, and set the entered secret in the application. This setup enables data to be sent securely to the DCR using an Entra token."
                  }
                },
                {
                  "parameters": {
                    "label": "Deploy cveBuster connector resources",
                    "applicationDisplayName": "cveBuster Vulnerability Scanner Application"
                  },
                  "type": "DeployPushConnectorButton"
                }
              ]
            },
            {
              "title": "2. Configure Your Application",
              "description": "After deployment, use the following parameters to configure your vulnerability scanner to push data to the workspace:",
              "instructions": [
                {
                  "type": "CopyableLabel",
                  "parameters": {
                    "label": "Tenant ID (Directory ID)",
                    "fillWith": [
                      "TenantId"
                    ]
                  }
                },
                {
                  "type": "CopyableLabel",
                  "parameters": {
                    "label": "Application (Client) ID",
                    "fillWith": [
                      "ApplicationId"
                    ],
                    "placeholder": "Deploy push connector to get the Application ID"
                  }
                },
                {
                  "type": "CopyableLabel",
                  "parameters": {
                    "label": "Application Secret",
                    "fillWith": [
                      "ApplicationSecret"
                    ],
                    "placeholder": "Deploy push connector to get the Application Secret"
                  }
                },
                {
                  "type": "CopyableLabel",
                  "parameters": {
                    "label": "Data Collection Endpoint",
                    "fillWith": [
                      "DataCollectionEndpoint"
                    ],
                    "placeholder": "Deploy push connector to get the Data Collection Endpoint"
                  }
                },
                {
                  "type": "CopyableLabel",
                  "parameters": {
                    "label": "Data Collection Rule Immutable ID",
                    "fillWith": [
                      "DataCollectionRuleId"
                    ],
                    "placeholder": "Deploy push connector to get the Data Collection Rule ID"
                  }
                },
                {
                  "type": "CopyableLabel",
                  "parameters": {
                    "label": "Stream Name",
                    "value": "Custom-cveBusterVulnerabilities"
                  }
                }
              ]
            }
          ]
        }
      }
    },
    {
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnectorDefinition2')))]",
      "apiVersion": "2022-01-01-preview",
      "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
      "properties": {
        "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectorDefinitions', variables('_dataConnectorContentIdConnectorDefinition2'))]",
        "contentId": "[variables('_dataConnectorContentIdConnectorDefinition2')]",
        "kind": "DataConnector",
        "version": "[variables('dataConnectorCCPVersion')]",
        "source": {
          "sourceId": "[variables('_solutionId')]",
          "name": "[variables('_solutionName')]",
          "kind": "Solution"
        },
        "author": {
          "name": "cveBuster",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Your Company Support",
          "email": "support@yourcompany.com",
          "tier": "Partner",
          "link": "https://yourcompany.com/support"
        },
        "dependencies": {
          "criteria": [
            {
              "version": "[variables('dataConnectorCCPVersion')]",
              "contentId": "[variables('_dataConnectorContentIdConnections2')]",
              "kind": "ResourcesDataConnector"
            }
          ]
        }
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('dataConnectorTemplateNameConnections2'), variables('dataConnectorCCPVersion'))]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "contentId": "[variables('_dataConnectorContentIdConnections2')]",
        "displayName": "cveBuster Vulnerability Scanner (Push)",
        "contentKind": "ResourcesDataConnector",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('dataConnectorCCPVersion')]",
          "parameters": {
            "guidValue": {
              "defaultValue": "[[newGuid()]",
              "type": "securestring"
            },
            "innerWorkspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "auth": {
              "type": "object",
              "defaultValue": {
                "appId": "[[parameters('auth').appId]]",
                "servicePrincipalId": "[[parameters('auth').servicePrincipalId]]"
              }
            },
            "connectorDefinitionName": {
              "defaultValue": "cveBuster Vulnerability Scanner (Push)",
              "type": "securestring",
              "minLength": 1
            },
            "workspace": {
              "defaultValue": "[parameters('workspace')]",
              "type": "securestring"
            },
            "dcrConfig": {
              "defaultValue": {
                "dataCollectionEndpoint": "data collection Endpoint",
                "dataCollectionRuleImmutableId": "data collection rule immutableId"
              },
              "type": "object"
            }
          },
          "variables": {
            "_dataConnectorContentIdConnections2": "[variables('_dataConnectorContentIdConnections2')]"
          },
          "resources": [
            {
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('DataConnector-', variables('_dataConnectorContentIdConnections2')))]",
              "apiVersion": "2022-01-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "properties": {
                "parentId": "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/dataConnectors', variables('_dataConnectorContentIdConnections2'))]",
                "contentId": "[variables('_dataConnectorContentIdConnections2')]",
                "kind": "ResourcesDataConnector",
                "version": "[variables('dataConnectorCCPVersion')]",
                "source": {
                  "sourceId": "[variables('_solutionId')]",
                  "name": "[variables('_solutionName')]",
                  "kind": "Solution"
                },
                "author": {
                  "name": "cveBuster",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Your Company Support",
                  "email": "support@yourcompany.com",
                  "tier": "Partner",
                  "link": "https://yourcompany.com/support"
                }
              }
            },
            {
              "name": "[[concat(parameters('innerWorkspace'),'/Microsoft.SecurityInsights/', 'cveBusterVulnerabilitiesPushConnector', parameters('guidValue'))]",
              "apiVersion": "2023-02-01-preview",
              "type": "Microsoft.OperationalInsights/workspaces/providers/dataConnectors",
              "location": "[parameters('workspace-location')]",
              "kind": "Push",
              "properties": {
                "connectorDefinitionName": "cveBusterVulnerabilitiesPushConnector",
                "dcrConfig": {
                  "streamName": "Custom-cveBusterVulnerabilities",
                  "dataCollectionEndpoint": "[[parameters('dcrConfig').dataCollectionEndpoint]",
                  "dataCollectionRuleImmutableId": "[[parameters('dcrConfig').dataCollectionRuleImmutableId]"
                },
                "auth": {
                  "type": "Push",
                  "AppId": "[[parameters('auth').appId]",
                  "ServicePrincipalId": "[[parameters('auth').servicePrincipalId]"
                },
                "request": {
                  "RetryCount": 1
                },
                "response": {
                  "eventsJsonPaths": [
                    "$"
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "contentProductId": "[concat(take(variables('_solutionId'), 50),'-','rdc','-', uniqueString(concat(variables('_solutionId'),'-','ResourcesDataConnector','-',variables('_dataConnectorContentIdConnections2'),'-', variables('dataConnectorCCPVersion'))))]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "version": "[variables('dataConnectorCCPVersion')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentTemplates",
      "apiVersion": "2023-04-01-preview",
      "name": "[variables('workbookTemplateSpecName1')]",
      "location": "[parameters('workspace-location')]",
      "dependsOn": [
        "[extensionResourceId(resourceId('Microsoft.OperationalInsights/workspaces', parameters('workspace')), 'Microsoft.SecurityInsights/contentPackages', variables('_solutionId'))]"
      ],
      "properties": {
        "description": "cveBuster Workbook with template version 3.0.0",
        "mainTemplate": {
          "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
          "contentVersion": "[variables('workbookVersion1')]",
          "parameters": {},
          "variables": {},
          "resources": [
            {
              "type": "Microsoft.Insights/workbooks",
              "name": "[variables('workbookContentId1')]",
              "location": "[parameters('workspace-location')]",
              "kind": "shared",
              "apiVersion": "2021-08-01",
              "metadata": {
                "description": "Comprehensive visibility into vulnerability scan data from cveBuster, including CVE details, asset risk profiles, patch status, and exploit intelligence."
              },
              "properties": {
                "displayName": "[parameters('workbook1-name')]",
                "serializedData": "{\"version\":\"Notebook/1.0\",\"items\":[{\"type\":1,\"content\":{\"json\":\"## cveBuster Vulnerability Scanner Dashboard\\n\\n---\\n\\nThis workbook provides comprehensive visibility into vulnerability scan data from cveBuster, including CVE details, asset risk profiles, patch status, and exploit intelligence.\"},\"name\":\"text - header\"},{\"type\":9,\"content\":{\"version\":\"KqlParameterItem/1.0\",\"parameters\":[{\"id\":\"cd8447d9-b096-4673-92d8-2a1e8291a125\",\"version\":\"KqlParameterItem/1.0\",\"name\":\"TimeRange\",\"type\":4,\"description\":\"Time range for vulnerability analysis\",\"value\":{\"durationMs\":604800000},\"typeSettings\":{\"selectableValues\":[{\"durationMs\":3600000},{\"durationMs\":86400000},{\"durationMs\":604800000},{\"durationMs\":2592000000},{\"durationMs\":7776000000}]},\"timeContext\":{\"durationMs\":86400000}}],\"style\":\"pills\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\"},\"name\":\"parameters - timerange\"},{\"type\":1,\"content\":{\"json\":\"### Executive Summary\"},\"name\":\"text - summary header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"let total_vulns = cveBusterVulnerabilities_CL\\n| summarize cnt = count()\\n| extend title = 'Total Vulnerabilities';\\nlet critical_vulns = cveBusterVulnerabilities_CL\\n| where Severity == 'Critical'\\n| summarize cnt = count()\\n| extend title = 'Critical Vulnerabilities';\\nlet exploitable = cveBusterVulnerabilities_CL\\n| where ExploitAvailable == true\\n| summarize cnt = count()\\n| extend title = 'With Public Exploits';\\nlet exploited = cveBusterVulnerabilities_CL\\n| where ExploitedInWild == true\\n| summarize cnt = count()\\n| extend title = 'Exploited in Wild';\\nlet unpatched = cveBusterVulnerabilities_CL\\n| where PatchAvailable == false\\n| summarize cnt = count()\\n| extend title = 'No Patch Available';\\nlet affected_assets = cveBusterVulnerabilities_CL\\n| summarize cnt = dcount(MachineName)\\n| extend title = 'Affected Assets';\\nunion isfuzzy=true total_vulns, critical_vulns, exploitable, exploited, unpatched, affected_assets\",\"size\":3,\"title\":\"Key Metrics\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"tiles\",\"tileSettings\":{\"titleContent\":{\"columnMatch\":\"title\",\"formatter\":1},\"leftContent\":{\"columnMatch\":\"cnt\",\"formatter\":12,\"formatOptions\":{\"palette\":\"auto\"},\"numberFormat\":{\"unit\":17,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":0}}},\"showBorder\":true}},\"name\":\"query - key metrics\"},{\"type\":1,\"content\":{\"json\":\"### Vulnerability Trends\"},\"name\":\"text - trends header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"cveBusterVulnerabilities_CL\\r\\n| make-series TotalVulns = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by Severity;\",\"size\":0,\"title\":\"Vulnerabilities Over Time by Severity\",\"color\":\"redBright\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"timechart\"},\"customWidth\":\"50\",\"name\":\"query - vulns over time\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"cveBusterVulnerabilities_CL\\r\\n| summarize Count = count() by Severity\\r\\n| order by Count desc\",\"size\":3,\"title\":\"Vulnerability Distribution by Severity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\",\"chartSettings\":{\"seriesLabelSettings\":[{\"seriesName\":\"Critical\",\"color\":\"redBright\"},{\"seriesName\":\"High\",\"color\":\"orange\"},{\"seriesName\":\"Medium\",\"color\":\"yellow\"},{\"seriesName\":\"Low\",\"color\":\"blue\"}]}},\"customWidth\":\"50\",\"name\":\"query - severity distribution\"},{\"type\":1,\"content\":{\"json\":\"### Risk Assessment\"},\"name\":\"text - risk header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"cveBusterVulnerabilities_CL\\r\\n| where Severity == 'Critical' and ExploitAvailable == true\\r\\n| summarize VulnCount = count(), AvgCVSS = avg(CVSS), MaxCVSS = max(CVSS) by MachineName, AssetCriticality\\r\\n| order by VulnCount desc, AvgCVSS desc\\r\\n| take 15\",\"size\":0,\"title\":\"Top 15 Critical Assets - Exploitable Vulnerabilities\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"VulnCount\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redBright\"}},{\"columnMatch\":\"AvgCVSS\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":1}}},{\"columnMatch\":\"MaxCVSS\",\"formatter\":8,\"formatOptions\":{\"palette\":\"red\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":1}}}]}},\"customWidth\":\"50\",\"name\":\"query - critical assets\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"cveBusterVulnerabilities_CL\\r\\n| summarize Count = count() by AssetCriticality\\r\\n| order by Count desc\",\"size\":3,\"title\":\"Vulnerabilities by Asset Criticality\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"50\",\"name\":\"query - asset criticality\"},{\"type\":1,\"content\":{\"json\":\"### Exploit Intelligence\"},\"name\":\"text - exploit header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"cveBusterVulnerabilities_CL\\r\\n| where ExploitAvailable == true\\r\\n| where Severity in ('Critical', 'High')\\r\\n| summarize AffectedAssets = dcount(MachineName), TotalInstances = count(), AvgCVSS = avg(CVSS), MaxCVSS = max(CVSS) by VulnId, VulnTitle, Severity, ExploitedInWild, PatchAvailable\\r\\n| order by ExploitedInWild desc, Severity desc, AvgCVSS desc\\r\\n| take 20\",\"size\":0,\"title\":\"Top 20 Exploitable Vulnerabilities (Critical & High)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"VulnId\",\"formatter\":5},{\"columnMatch\":\"Severity\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"Critical\",\"representation\":\"4\",\"text\":\"{0}{1}\"},{\"operator\":\"==\",\"thresholdValue\":\"High\",\"representation\":\"2\",\"text\":\"{0}{1}\"},{\"operator\":\"Default\",\"representation\":\"success\",\"text\":\"{0}{1}\"}]}},{\"columnMatch\":\"ExploitedInWild\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"4\",\"text\":\"YES\"},{\"operator\":\"Default\",\"representation\":\"success\",\"text\":\"NO\"}]}},{\"columnMatch\":\"PatchAvailable\",\"formatter\":18,\"formatOptions\":{\"thresholdsOptions\":\"icons\",\"thresholdsGrid\":[{\"operator\":\"==\",\"thresholdValue\":\"true\",\"representation\":\"success\",\"text\":\"YES\"},{\"operator\":\"Default\",\"representation\":\"4\",\"text\":\"NO\"}]}},{\"columnMatch\":\"AffectedAssets\",\"formatter\":8,\"formatOptions\":{\"palette\":\"blue\"}},{\"columnMatch\":\"AvgCVSS\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":1}}}]}},\"name\":\"query - exploitable vulns\"},{\"type\":1,\"content\":{\"json\":\"### Patch Management\"},\"name\":\"text - patch header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"cveBusterVulnerabilities_CL\\r\\n| summarize Patched = countif(PatchAvailable == true), Unpatched = countif(PatchAvailable == false)\\r\\n| project Status = pack_array('Patch Available', 'No Patch'), Count = pack_array(Patched, Unpatched)\\r\\n| mvexpand Status to typeof(string), Count to typeof(long)\",\"size\":3,\"title\":\"Patch Availability Status\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"piechart\"},\"customWidth\":\"33\",\"name\":\"query - patch status\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"cveBusterVulnerabilities_CL\\r\\n| where PatchAvailable == false\\r\\n| summarize Count = count() by Severity\\r\\n| order by Count desc\",\"size\":3,\"title\":\"Unpatched Vulnerabilities by Severity\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"33\",\"name\":\"query - unpatched severity\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"cveBusterVulnerabilities_CL\\r\\n| where PatchAvailable == false and Severity in ('Critical', 'High')\\r\\n| summarize Count = count() by MachineName\\r\\n| order by Count desc\\r\\n| take 10\",\"size\":3,\"title\":\"Top 10 Assets with Unpatched Critical/High Vulnerabilities\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"34\",\"name\":\"query - unpatched assets\"},{\"type\":1,\"content\":{\"json\":\"### CVSS Score Analysis\"},\"name\":\"text - cvss header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"cveBusterVulnerabilities_CL\\r\\n| summarize Count = count() by bin(CVSS, 1.0)\\r\\n| order by CVSS asc\",\"size\":0,\"title\":\"CVSS Score Distribution\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"customWidth\":\"50\",\"name\":\"query - cvss distribution\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"cveBusterVulnerabilities_CL\\r\\n| where CVSS >= 9.0\\r\\n| summarize Count = count(), AvgCVSS = avg(CVSS), MaxCVSS = max(CVSS) by MachineName\\r\\n| order by Count desc, AvgCVSS desc\\r\\n| take 10\",\"size\":0,\"title\":\"Top 10 Assets with CVSS >= 9.0\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"table\",\"gridSettings\":{\"formatters\":[{\"columnMatch\":\"Count\",\"formatter\":8,\"formatOptions\":{\"palette\":\"redBright\"}},{\"columnMatch\":\"AvgCVSS\",\"formatter\":8,\"formatOptions\":{\"palette\":\"orange\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":1}}},{\"columnMatch\":\"MaxCVSS\",\"formatter\":8,\"formatOptions\":{\"palette\":\"red\"},\"numberFormat\":{\"unit\":0,\"options\":{\"style\":\"decimal\",\"maximumFractionDigits\":1}}}]}},\"customWidth\":\"50\",\"name\":\"query - high cvss assets\"},{\"type\":1,\"content\":{\"json\":\"### Recent Vulnerability Discoveries\"},\"name\":\"text - recent header\"},{\"type\":3,\"content\":{\"version\":\"KqlItem/1.0\",\"query\":\"cveBusterVulnerabilities_CL\\r\\n| where TimeGenerated > ago(7d)\\r\\n| summarize Count = count() by bin(TimeGenerated, 1d), Severity\\r\\n| order by TimeGenerated desc\",\"size\":0,\"title\":\"New Vulnerabilities Detected (Last 7 Days)\",\"timeContext\":{\"durationMs\":0},\"timeContextFromParameter\":\"TimeRange\",\"queryType\":0,\"resourceType\":\"microsoft.operationalinsights/workspaces\",\"visualization\":\"barchart\"},\"name\":\"query - recent discoveries\"}],\"fromTemplateId\":\"sentinel-cveBusterWorkbook\",\"$schema\":\"https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json\"}\r\n",
                "version": "1.0",
                "sourceId": "[variables('workspaceResourceId')]",
                "category": "sentinel"
              }
            },
            {
              "type": "Microsoft.OperationalInsights/workspaces/providers/metadata",
              "apiVersion": "2022-01-01-preview",
              "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/',concat('Workbook-', last(split(variables('workbookId1'),'/'))))]",
              "properties": {
                "description": "@{workbookKey=cveBusterWorkbook; logoFileName=Azure_Sentinel.svg; description=Comprehensive visibility into vulnerability scan data from cveBuster, including CVE details, asset risk profiles, patch status, and exploit intelligence.; dataTypesDependencies=System.Object[]; dataConnectorsDependencies=System.Object[]; previewImagesFileNames=System.Object[]; version=1.0.0; title=cveBuster Vulnerability Scanner Dashboard; templateRelativePath=cveBuster.json; subtitle=; provider=cveBuster}.description",
                "parentId": "[variables('workbookId1')]",
                "contentId": "[variables('_workbookContentId1')]",
                "kind": "Workbook",
                "version": "[variables('workbookVersion1')]",
                "source": {
                  "kind": "Solution",
                  "name": "cveBuster Vulnerability Scanning",
                  "sourceId": "[variables('_solutionId')]"
                },
                "author": {
                  "name": "cveBuster",
                  "email": "[variables('_email')]"
                },
                "support": {
                  "name": "Your Company Support",
                  "email": "support@yourcompany.com",
                  "tier": "Partner",
                  "link": "https://yourcompany.com/support"
                },
                "dependencies": {
                  "operator": "AND",
                  "criteria": [
                    {
                      "contentId": "cveBusterVulnerabilities_CL",
                      "kind": "DataType"
                    },
                    {
                      "contentId": "cveBusterVulnerabilitiesLogs_ccf",
                      "kind": "DataConnector"
                    },
                    {
                      "contentId": "cveBusterVulnerabilitiesPush_ccf",
                      "kind": "DataConnector"
                    }
                  ]
                }
              }
            }
          ]
        },
        "packageKind": "Solution",
        "packageVersion": "[variables('_solutionVersion')]",
        "packageName": "[variables('_solutionName')]",
        "packageId": "[variables('_solutionId')]",
        "contentSchemaVersion": "3.0.0",
        "contentId": "[variables('_workbookContentId1')]",
        "contentKind": "Workbook",
        "displayName": "[parameters('workbook1-name')]",
        "contentProductId": "[variables('_workbookcontentProductId1')]",
        "id": "[variables('_workbookcontentProductId1')]",
        "version": "[variables('workbookVersion1')]"
      }
    },
    {
      "type": "Microsoft.OperationalInsights/workspaces/providers/contentPackages",
      "apiVersion": "2023-04-01-preview",
      "location": "[parameters('workspace-location')]",
      "properties": {
        "version": "3.0.0",
        "kind": "Solution",
        "contentSchemaVersion": "3.0.0",
        "displayName": "cveBuster Vulnerability Scanning",
        "publisherDisplayName": "Your Company Support",
        "descriptionHtml": "<p><strong>Note:</strong> Please refer to the following before installing the solution:</p>\n<p> Review the solution <a href=\"https://github.com/Azure/Azure-Sentinel/tree/master/Solutions/cveBuster%20Vulnerability%20Scanning/ReleaseNotes.md\">Release Notes</a></p>\n<p> There may be <a href=\"https://aka.ms/sentinelsolutionsknownissues\">known issues</a> pertaining to this Solution, please refer to them before installing.</p>\n<p>The cveBuster Vulnerability Scanning solution provides automated vulnerability data ingestion from your cveBuster API into Microsoft Sentinel using the Codeless Connector Framework (CCF). This connector polls your vulnerability scanner API with automatic pagination handling and ingests comprehensive vulnerability scan data including CVE details, asset information, patch availability, and exploit intelligence.</p>\n<p><strong>Data Connectors:</strong> 2, <strong>Workbooks:</strong> 1</p>\n<p><a href=\"https://aka.ms/azuresentinel\">Learn more about Microsoft Sentinel</a> | <a href=\"https://aka.ms/azuresentinelsolutionsdoc\">Learn more about Solutions</a></p>\n",
        "contentKind": "Solution",
        "contentProductId": "[variables('_solutioncontentProductId')]",
        "id": "[variables('_solutioncontentProductId')]",
        "icon": "<svg>...</svg>",
        "contentId": "[variables('_solutionId')]",
        "parentId": "[variables('_solutionId')]",
        "source": {
          "kind": "Solution",
          "name": "cveBuster Vulnerability Scanning",
          "sourceId": "[variables('_solutionId')]"
        },
        "author": {
          "name": "cveBuster",
          "email": "[variables('_email')]"
        },
        "support": {
          "name": "Your Company Support",
          "email": "support@yourcompany.com",
          "tier": "Partner",
          "link": "https://yourcompany.com/support"
        },
        "dependencies": {
          "operator": "AND",
          "criteria": [
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentIdConnections1')]",
              "version": "[variables('dataConnectorCCPVersion')]"
            },
            {
              "kind": "DataConnector",
              "contentId": "[variables('_dataConnectorContentIdConnections2')]",
              "version": "[variables('dataConnectorCCPVersion')]"
            },
            {
              "kind": "Workbook",
              "contentId": "[variables('_workbookContentId1')]",
              "version": "[variables('workbookVersion1')]"
            }
          ]
        },
        "firstPublishDate": "2025-11-02",
        "lastPublishDate": "2025-11-02",
        "providers": [
          "Your Company"
        ],
        "categories": {
          "domains": [
            "Security - Vulnerability Management",
            "Security - Threat Protection"
          ]
        }
      },
      "name": "[concat(parameters('workspace'),'/Microsoft.SecurityInsights/', variables('_solutionId'))]"
    }
  ],
  "outputs": {}
}

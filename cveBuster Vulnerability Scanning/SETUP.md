# cveBuster Complete Setup Guide

This guide provides step-by-step instructions for setting up the cveBuster Vulnerability Scanning solution from scratch on a fresh Ubuntu VM.

## Prerequisites

- Ubuntu 20.04 LTS or later
- Internet connectivity
- Git installed (`git --version` to verify)
- Sudo access (for port 80 binding)
- Python 3.9+ (`python3 --version` to verify)

## Step 1: Clone the Repository

```bash
cd ~
git clone https://github.com/robertmoriarty12/cveBusterPull-Lift.git
cd cveBusterPull-Lift/"cveBuster Vulnerability Scanning2"/Server
```

## Step 2: Run the Setup Script

The `setup.sh` script automates the entire installation process:

```bash
sudo bash setup.sh full
```

**What this script does:**
- Updates system packages
- Installs Python 3, pip, and development tools
- Creates a Python virtual environment
- Installs Flask and dependencies
- Generates 500 test vulnerability records
- Configures systemd services for API and documentation servers
- Creates systemd service files for auto-startup

## Step 3: Verify Installation

Check that both services are configured:

```bash
sudo systemctl status cvebuster-api
sudo systemctl status cvebuster-docs
```

Expected output: Both services should show as "loaded" (may be inactive initially).

## Step 4: Start Services Manually (If Systemd Fails)

If the systemd services fail to start, you can run them manually:

**Terminal 1 - Start API Server (Port 5000):**
```bash
cd ~/cveBusterPull-Lift/"cveBuster Vulnerability Scanning2"/Server
source venv/bin/activate
sed -i 's/port=80/port=5000/g' app_paginated.py
python3 app_paginated.py
```

Expected output:
```
 * Serving Flask app 'app_paginated'
 * Debug mode: on
 * Running on http://0.0.0.0:5000
```

**Terminal 2 - Start Docs Server (Port 80):**
```bash
cd ~/cveBusterPull-Lift/"cveBuster Vulnerability Scanning2"/Server/api_docs
sudo python3 server_linux.py
```

Expected output:
```
Starting cveBuster API Documentation Server on port 80...
Server running at http://0.0.0.0:80
```

## Step 5: Test the API

In a third terminal, test the API endpoint:

```bash
curl -H "Authorization: cvebuster-demo-key-12345" \
  "http://cvebuster.eastus.cloudapp.azure.com:5000/api/vulnerabilities?page_size=50"
```

Or use localhost:
```bash
curl -H "Authorization: cvebuster-demo-key-12345" \
  "http://localhost:5000/api/vulnerabilities?page_size=50"
```

**Expected Response:**
```json
{
  "vulnerabilities": [
    {
      "VulnId": "CVE-2024-49113",
      "VulnTitle": "Windows Kerberos Elevation of Privilege Vulnerability",
      "Severity": "Critical",
      "CVSS": 9.8,
      "MachineName": "BobVM",
      "AssetCriticality": "High",
      "PatchAvailable": false,
      "ExploitAvailable": true,
      "DiscoveryDate": "2025-01-10T14:20:00Z",
      "LastModified": "2025-01-14T09:45:30Z",
      "Status": "Open"
    }
    ...
  ],
  "next_token": "MjA=",
  "total_filtered": 505,
  "page_size": 50,
  "offset": 0
}
```

## Step 6: Access the Documentation Portal

Open your web browser and navigate to:

```
http://cvebuster.eastus.cloudapp.azure.com
```

Or use the Azure VM's public IP if the DNS name isn't available yet.

The documentation portal includes:
- API Overview
- Authentication details
- Data Schema (11 fields)
- Endpoint documentation
- Pagination examples
- Time-based filtering guide
- Error handling reference

## Project Structure

```
cveBuster Vulnerability Scanning2/
├── Server/
│   ├── setup.sh                          # Automated setup script
│   ├── app_paginated.py                  # Flask API server
│   ├── generate_data.py                  # Test data generator
│   ├── cvebuster_data.json               # Generated vulnerability data (505 records)
│   ├── README.md                         # API server documentation
│   ├── venv/                             # Python virtual environment
│   └── api_docs/
│       ├── index.html                    # Documentation portal
│       ├── server.py                     # Docs server (Windows/macOS)
│       ├── server_linux.py               # Docs server (Linux)
│       ├── README.md                     # Docs server documentation
│       ├── QUICKSTART.md                 # Quick start guide
│       └── SETUP_GUIDE.md                # Detailed setup instructions
├── Data/
│   └── Solution_cveBuster.json          # Solution metadata
├── Data Connectors/
│   └── cveBusterVulnerabilitiesLogs_ccf/ # CCF connector configuration
├── Package/                              # Generated solution package
├── README.md                             # Main documentation
├── API_DOCUMENTATION.md                  # API reference
└── DEPLOYMENT_CHECKLIST.md              # Pre-deployment checklist
```

## Data Schema

The API returns 505 vulnerability records with the following fields:

| Field | Type | Example |
|-------|------|---------|
| VulnId | string | CVE-2024-49113 |
| VulnTitle | string | Windows Kerberos Elevation of Privilege Vulnerability |
| Severity | string | Critical, High, Medium, Low |
| CVSS | float | 9.8 |
| MachineName | string | BobVM, SRV-WEB-001 |
| AssetCriticality | string | High, Medium, Low |
| PatchAvailable | boolean | true/false |
| ExploitAvailable | boolean | true/false |
| DiscoveryDate | ISO 8601 | 2025-01-10T14:20:00Z |
| LastModified | ISO 8601 | 2025-01-14T09:45:30Z |
| Status | string | Open, In Progress, Patched |

## Data Distribution

- **505 total records**
- **5 high-priority records** from BobVM with real Windows CVEs (updated within last 2 minutes)
- **30% recent records** (150 total) - modified within last 2 minutes
- **70% historical records** (350 total) - modified 30-90 days ago

This distribution is designed to test pagination and time-based filtering in the CCF 5-minute polling window.

## API Endpoints

**GET /api/vulnerabilities**

**Headers:**
```
Authorization: cvebuster-demo-key-12345
```

**Query Parameters:**
- `page_size` (int, optional) - Records per page (default: 50, max: 1000)
- `next_token` / `nextToken` (string, optional) - Pagination cursor
- `createdAt__gt` (ISO 8601, optional) - Return records modified after this timestamp
- `createdAt__lt` (ISO 8601, optional) - Return records modified before this timestamp

**Example Requests:**

Get first 50 records:
```bash
curl -H "Authorization: cvebuster-demo-key-12345" \
  "http://localhost:5000/api/vulnerabilities?page_size=50"
```

Get next page:
```bash
curl -H "Authorization: cvebuster-demo-key-12345" \
  "http://localhost:5000/api/vulnerabilities?page_size=50&next_token=MjA="
```

Filter by time range (last 2 minutes):
```bash
curl -H "Authorization: cvebuster-demo-key-12345" \
  "http://localhost:5000/api/vulnerabilities?createdAt__gt=2025-01-14T09:43:30Z&createdAt__lt=2025-01-14T09:45:30Z"
```

## Troubleshooting

### Port 80 Access Denied
The documentation server needs sudo to bind to port 80. Make sure to run:
```bash
sudo python3 server_linux.py
```

### API Server on Wrong Port
If the API runs on port 80 instead of 5000, update the port:
```bash
sed -i 's/port=80/port=5000/g' app_paginated.py
python3 app_paginated.py
```

### Systemd Service Failures
If services fail, check the error:
```bash
sudo journalctl -u cvebuster-api -n 20
sudo journalctl -u cvebuster-docs -n 20
```

Run manually instead (see Step 4).

### Virtual Environment Not Activated
Always activate the virtual environment before running the API:
```bash
cd Server
source venv/bin/activate
python3 app_paginated.py
```

### Permission Issues with Venv
If you see permission errors when removing the old directory:
```bash
sudo rm -rf cveBusterPull-Lift
```

## Next Steps

1. **For Microsoft Sentinel Integration:**
   - Deploy the CCF connector from `Data Connectors/cveBusterVulnerabilitiesLogs_ccf/`
   - Configure the API endpoint in the connector settings
   - Test data ingestion into Sentinel

2. **For Production Use:**
   - Change the default API key in `app_paginated.py`
   - Use HTTPS instead of HTTP
   - Enable SSL certificates
   - Configure firewall rules appropriately

3. **For Custom Data:**
   - Modify `generate_data.py` to generate your own vulnerability data
   - Update field mappings in the API response
   - Regenerate data with `python3 generate_data.py`

## Support

For issues or questions:
- Check the API documentation at `http://cvebuster.eastus.cloudapp.azure.com`
- Review logs: `sudo journalctl -u cvebuster-api -f`
- Check `api_docs/README.md` for documentation server details
- Review `Server/README.md` for API server details

---

**Version:** 1.0  
**Last Updated:** January 14, 2025  
**Repository:** https://github.com/robertmoriarty12/cveBusterPull-Lift

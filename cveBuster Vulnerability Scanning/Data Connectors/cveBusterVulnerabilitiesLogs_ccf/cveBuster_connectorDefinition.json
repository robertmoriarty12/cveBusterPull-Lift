{
  "name": "cveBusterVulnerabilitiesConnectorDefinition",
  "apiVersion": "2024-01-01-preview",
  "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
  "kind": "Customizable",
  "properties": {
    "connectorUiConfig": {
      "id": "cveBusterVulnerabilitiesConnector",
      "title": "cveBuster Vulnerability Scanner",
      "publisher": "cveBuster",
      "descriptionMarkdown": "The cveBuster data connector provides automated ingestion of vulnerability scan data from your cveBuster API into Microsoft Sentinel. This connector uses the Codeless Connector Framework (CCF) with REST API polling to continuously fetch vulnerability information including CVE details, CVSS scores, patch availability, exploit intelligence, and asset criticality. Data is ingested into a custom Log Analytics table for analysis, alerting, and visualization.",
      "graphQueriesTableName": "cveBusterVulnerabilities_CL",
      "graphQueries": [
        {
          "metricName": "Total vulnerability records",
          "legend": "cveBuster Vulnerabilities",
          "baseQuery": "{{graphQueriesTableName}}"
        }
      ],
      "sampleQueries": [
        {
          "description": "All vulnerability records",
          "query": "{{graphQueriesTableName}}\n| take 10"
        },
        {
          "description": "Critical vulnerabilities with active exploits",
          "query": "{{graphQueriesTableName}}\n| where Severity == 'Critical' and ExploitAvailable == true\n| project TimeGenerated, MachineName, VulnId, VulnTitle, CVSS, ExploitedInWild"
        },
        {
          "description": "Vulnerability count by severity",
          "query": "{{graphQueriesTableName}}\n| summarize Count=count() by Severity\n| render piechart"
        }
      ],
      "dataTypes": [
        {
          "name": "{{graphQueriesTableName}}",
          "lastDataReceivedQuery": "{{graphQueriesTableName}}\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
        }
      ],
      "connectivityCriteria": [
        {
          "type": "HasDataConnectors",
          "value": null
        }
      ],
      "availability": {
        "status": 1,
        "isPreview": false
      },
      "permissions": {
        "resourceProvider": [
          {
            "provider": "Microsoft.OperationalInsights/workspaces",
            "permissionsDisplayText": "Read and Write permissions are required.",
            "providerDisplayName": "Workspace",
            "scope": "Workspace",
            "requiredPermissions": {
              "write": true,
              "read": true,
              "delete": true
            }
          },
          {
            "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
            "permissionsDisplayText": "Read permissions to shared keys for the workspace are required. [See the documentation to learn more about workspace keys](https://docs.microsoft.com/azure/azure-monitor/platform/agent-windows#obtain-workspace-id-and-key).",
            "providerDisplayName": "Keys",
            "scope": "Workspace",
            "requiredPermissions": {
              "action": true
            }
          }
        ],
        "customs": [
          {
            "name": "cveBuster API Access",
            "description": "An API key with read access to the cveBuster vulnerability scanning API is required."
          }
        ]
      },
      "instructionSteps": [
        {
          "title": "Configure Connection",
          "description": "Enter your cveBuster API endpoint and authentication key. The connector will poll the API every 5 minutes.",
          "instructions": [
            {
              "type": "Textbox",
              "parameters": {
                "label": "API Endpoint URL",
                "placeholder": "http://20.84.144.179:5000/api/vulnerabilities",
                "name": "apiEndpoint"
              }
            },
            {
              "type": "Textbox",
              "parameters": {
                "label": "API Key",
                "placeholder": "Enter your API key",
                "name": "apiKey"
              }
            },
            {
              "type": "ConnectionToggleButton",
              "parameters": {}
            }
          ]
        }
      ]
    }
  }
}

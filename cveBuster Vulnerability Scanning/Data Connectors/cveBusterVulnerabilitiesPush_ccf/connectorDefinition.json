{
  "name": "cveBusterVulnerabilitiesPushConnectorDefinition",
  "apiVersion": "2024-01-01-preview",
  "type": "Microsoft.SecurityInsights/dataConnectorDefinitions",
  "kind": "Customizable",
  "properties": {
    "connectorUiConfig": {
      "id": "cveBusterVulnerabilitiesPushConnector",
      "title": "cveBuster Vulnerability Scanner (Push)",
      "publisher": "cveBuster",
      "descriptionMarkdown": "The cveBuster Push data connector enables real-time vulnerability data ingestion into Microsoft Sentinel. Your vulnerability scanning application pushes data directly to Azure using the Azure Monitor Ingestion API with Service Principal authentication. This eliminates the need for API polling and provides near-instant visibility into newly discovered vulnerabilities.",
      "graphQueriesTableName": "cveBusterVulnerabilities_CL",
      "graphQueries": [
        {
          "metricName": "Total vulnerability records",
          "legend": "cveBuster Vulnerabilities (Push)",
          "baseQuery": "{{graphQueriesTableName}}"
        }
      ],
      "sampleQueries": [
        {
          "description": "All vulnerability records",
          "query": "{{graphQueriesTableName}}\n| take 10"
        },
        {
          "description": "Critical vulnerabilities with active exploits",
          "query": "{{graphQueriesTableName}}\n| where Severity == 'Critical' and ExploitAvailable == true\n| project TimeGenerated, MachineName, VulnId, VulnTitle, CVSS"
        },
        {
          "description": "Recent vulnerabilities (last hour)",
          "query": "{{graphQueriesTableName}}\n| where TimeGenerated > ago(1h)\n| summarize Count=count() by Severity\n| render piechart"
        }
      ],
      "dataTypes": [
        {
          "name": "{{graphQueriesTableName}}",
          "lastDataReceivedQuery": "{{graphQueriesTableName}}\n| summarize Time = max(TimeGenerated)\n| where isnotempty(Time)"
        }
      ],
      "connectivityCriteria": [
        {
          "type": "HasDataConnectors",
          "value": null
        }
      ],
      "availability": {
        "isPreview": true
      },
      "permissions": {
        "resourceProvider": [
          {
            "provider": "Microsoft.OperationalInsights/workspaces",
            "permissionsDisplayText": "Read and Write permissions are required.",
            "providerDisplayName": "Workspace",
            "scope": "Workspace",
            "requiredPermissions": {
              "write": true,
              "read": true,
              "delete": true
            }
          },
          {
            "provider": "Microsoft.OperationalInsights/workspaces/sharedKeys",
            "permissionsDisplayText": "Read permissions to shared keys for the workspace are required.",
            "providerDisplayName": "Keys",
            "scope": "Workspace",
            "requiredPermissions": {
              "action": true
            }
          }
        ],
        "customs": [
          {
            "name": "Azure Service Principal",
            "description": "A Service Principal with Monitoring Metrics Publisher role on the Data Collection Rule is required for authentication."
          }
        ]
      },
      "instructionSteps": [
        {
          "title": "1. Deploy Push Connector Resources",
          "description": "Click the button below to deploy Azure resources required for CCF Push ingestion. This creates a Service Principal, Data Collection Endpoint (DCE), Data Collection Rule (DCR), and custom Log Analytics table.",
          "instructions": [
            {
              "type": "Markdown",
              "parameters": {
                "content": "#### Automated Configuration and Secure Data Ingestion with Entra Application\nClicking on **Deploy** will trigger the creation of Log Analytics tables and a Data Collection Rule (DCR). It will then create an Entra application, link the DCR to it, and set the entered secret in the application. This setup enables data to be sent securely to the DCR using an Entra token."
              }
            },
            {
              "parameters": {
                "label": "Deploy cveBuster connector resources",
                "applicationDisplayName": "cveBuster Vulnerability Scanner Application"
              },
              "type": "DeployPushConnectorButton"
            }
          ]
        },
        {
          "title": "2. Configure Your Application",
          "description": "After deployment, use the following parameters to configure your vulnerability scanner to push data to the workspace:",
          "instructions": [
            {
              "type": "CopyableLabel",
              "parameters": {
                "label": "Tenant ID (Directory ID)",
                "fillWith": ["TenantId"]
              }
            },
            {
              "type": "CopyableLabel",
              "parameters": {
                "label": "Application (Client) ID",
                "fillWith": ["ApplicationId"],
                "placeholder": "Deploy push connector to get the Application ID"
              }
            },
            {
              "type": "CopyableLabel",
              "parameters": {
                "label": "Application Secret",
                "fillWith": ["ApplicationSecret"],
                "placeholder": "Deploy push connector to get the Application Secret"
              }
            },
            {
              "type": "CopyableLabel",
              "parameters": {
                "label": "Data Collection Endpoint",
                "fillWith": ["DataCollectionEndpoint"],
                "placeholder": "Deploy push connector to get the Data Collection Endpoint"
              }
            },
            {
              "type": "CopyableLabel",
              "parameters": {
                "label": "Data Collection Rule Immutable ID",
                "fillWith": ["DataCollectionRuleId"],
                "placeholder": "Deploy push connector to get the Data Collection Rule ID"
              }
            },
            {
              "type": "CopyableLabel",
              "parameters": {
                "label": "Stream Name",
                "value": "Custom-cveBusterVulnerabilities"
              }
            }
          ]
        }
      ]
    }
  }
}

{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "## cveBuster Vulnerability Scanner Dashboard\n\n---\n\nThis workbook provides comprehensive visibility into vulnerability scan data from cveBuster, including CVE details, asset risk profiles, patch status, and exploit intelligence."
      },
      "name": "text - header"
    },
    {
      "type": 9,
      "content": {
        "version": "KqlParameterItem/1.0",
        "parameters": [
          {
            "id": "cd8447d9-b096-4673-92d8-2a1e8291a125",
            "version": "KqlParameterItem/1.0",
            "name": "TimeRange",
            "type": 4,
            "description": "Time range for vulnerability analysis",
            "value": {
              "durationMs": 604800000
            },
            "typeSettings": {
              "selectableValues": [
                {
                  "durationMs": 3600000
                },
                {
                  "durationMs": 86400000
                },
                {
                  "durationMs": 604800000
                },
                {
                  "durationMs": 2592000000
                },
                {
                  "durationMs": 7776000000
                }
              ]
            },
            "timeContext": {
              "durationMs": 86400000
            }
          }
        ],
        "style": "pills",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces"
      },
      "name": "parameters - timerange"
    },
    {
      "type": 1,
      "content": {
        "json": "### Executive Summary"
      },
      "name": "text - summary header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "let total_vulns = cveBusterVulnerabilities_CL\n| summarize cnt = count()\n| extend title = 'Total Vulnerabilities';\nlet critical_vulns = cveBusterVulnerabilities_CL\n| where Severity == 'Critical'\n| summarize cnt = count()\n| extend title = 'Critical Vulnerabilities';\nlet exploitable = cveBusterVulnerabilities_CL\n| where ExploitAvailable == true\n| summarize cnt = count()\n| extend title = 'With Public Exploits';\nlet exploited = cveBusterVulnerabilities_CL\n| where ExploitedInWild == true\n| summarize cnt = count()\n| extend title = 'Exploited in Wild';\nlet unpatched = cveBusterVulnerabilities_CL\n| where PatchAvailable == false\n| summarize cnt = count()\n| extend title = 'No Patch Available';\nlet affected_assets = cveBusterVulnerabilities_CL\n| summarize cnt = dcount(MachineName)\n| extend title = 'Affected Assets';\nunion isfuzzy=true total_vulns, critical_vulns, exploitable, exploited, unpatched, affected_assets",
        "size": 3,
        "title": "Key Metrics",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "tiles",
        "tileSettings": {
          "titleContent": {
            "columnMatch": "title",
            "formatter": 1
          },
          "leftContent": {
            "columnMatch": "cnt",
            "formatter": 12,
            "formatOptions": {
              "palette": "auto"
            },
            "numberFormat": {
              "unit": 17,
              "options": {
                "style": "decimal",
                "maximumFractionDigits": 0
              }
            }
          },
          "showBorder": true
        }
      },
      "name": "query - key metrics"
    },
    {
      "type": 1,
      "content": {
        "json": "### Vulnerability Trends"
      },
      "name": "text - trends header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "cveBusterVulnerabilities_CL\r\n| make-series TotalVulns = count() default = 0 on TimeGenerated from {TimeRange:start} to {TimeRange:end} step {TimeRange:grain} by Severity;",
        "size": 0,
        "title": "Vulnerabilities Over Time by Severity",
        "color": "redBright",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "timechart"
      },
      "customWidth": "50",
      "name": "query - vulns over time"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "cveBusterVulnerabilities_CL\r\n| summarize Count = count() by Severity\r\n| order by Count desc",
        "size": 3,
        "title": "Vulnerability Distribution by Severity",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "piechart",
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "Critical",
              "color": "redBright"
            },
            {
              "seriesName": "High",
              "color": "orange"
            },
            {
              "seriesName": "Medium",
              "color": "yellow"
            },
            {
              "seriesName": "Low",
              "color": "blue"
            }
          ]
        }
      },
      "customWidth": "50",
      "name": "query - severity distribution"
    },
    {
      "type": 1,
      "content": {
        "json": "### Risk Assessment"
      },
      "name": "text - risk header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "cveBusterVulnerabilities_CL\r\n| where Severity == 'Critical' and ExploitAvailable == true\r\n| summarize VulnCount = count(), AvgCVSS = avg(CVSS), MaxCVSS = max(CVSS) by MachineName, AssetCriticality\r\n| order by VulnCount desc, AvgCVSS desc\r\n| take 15",
        "size": 0,
        "title": "Top 15 Critical Assets - Exploitable Vulnerabilities",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "VulnCount",
              "formatter": 8,
              "formatOptions": {
                "palette": "redBright"
              }
            },
            {
              "columnMatch": "AvgCVSS",
              "formatter": 8,
              "formatOptions": {
                "palette": "orange"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 1
                }
              }
            },
            {
              "columnMatch": "MaxCVSS",
              "formatter": 8,
              "formatOptions": {
                "palette": "red"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 1
                }
              }
            }
          ]
        }
      },
      "customWidth": "50",
      "name": "query - critical assets"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "cveBusterVulnerabilities_CL\r\n| summarize Count = count() by AssetCriticality\r\n| order by Count desc",
        "size": 3,
        "title": "Vulnerabilities by Asset Criticality",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "barchart"
      },
      "customWidth": "50",
      "name": "query - asset criticality"
    },
    {
      "type": 1,
      "content": {
        "json": "### Exploit Intelligence"
      },
      "name": "text - exploit header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "cveBusterVulnerabilities_CL\r\n| where ExploitAvailable == true\r\n| where Severity in ('Critical', 'High')\r\n| summarize AffectedAssets = dcount(MachineName), TotalInstances = count(), AvgCVSS = avg(CVSS), MaxCVSS = max(CVSS) by VulnId, VulnTitle, Severity, ExploitedInWild, PatchAvailable\r\n| order by ExploitedInWild desc, Severity desc, AvgCVSS desc\r\n| take 20",
        "size": 0,
        "title": "Top 20 Exploitable Vulnerabilities (Critical & High)",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "VulnId",
              "formatter": 5
            },
            {
              "columnMatch": "Severity",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "Critical",
                    "representation": "4",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "==",
                    "thresholdValue": "High",
                    "representation": "2",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "{0}{1}"
                  }
                ]
              }
            },
            {
              "columnMatch": "ExploitedInWild",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "true",
                    "representation": "4",
                    "text": "YES"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "success",
                    "text": "NO"
                  }
                ]
              }
            },
            {
              "columnMatch": "PatchAvailable",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "icons",
                "thresholdsGrid": [
                  {
                    "operator": "==",
                    "thresholdValue": "true",
                    "representation": "success",
                    "text": "YES"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": "4",
                    "text": "NO"
                  }
                ]
              }
            },
            {
              "columnMatch": "AffectedAssets",
              "formatter": 8,
              "formatOptions": {
                "palette": "blue"
              }
            },
            {
              "columnMatch": "AvgCVSS",
              "formatter": 8,
              "formatOptions": {
                "palette": "orange"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 1
                }
              }
            }
          ]
        }
      },
      "name": "query - exploitable vulns"
    },
    {
      "type": 1,
      "content": {
        "json": "### Patch Management"
      },
      "name": "text - patch header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "cveBusterVulnerabilities_CL\r\n| summarize Patched = countif(PatchAvailable == true), Unpatched = countif(PatchAvailable == false)\r\n| project Status = pack_array('Patch Available', 'No Patch'), Count = pack_array(Patched, Unpatched)\r\n| mvexpand Status to typeof(string), Count to typeof(long)",
        "size": 3,
        "title": "Patch Availability Status",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "piechart"
      },
      "customWidth": "33",
      "name": "query - patch status"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "cveBusterVulnerabilities_CL\r\n| where PatchAvailable == false\r\n| summarize Count = count() by Severity\r\n| order by Count desc",
        "size": 3,
        "title": "Unpatched Vulnerabilities by Severity",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "barchart"
      },
      "customWidth": "33",
      "name": "query - unpatched severity"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "cveBusterVulnerabilities_CL\r\n| where PatchAvailable == false and Severity in ('Critical', 'High')\r\n| summarize Count = count() by MachineName\r\n| order by Count desc\r\n| take 10",
        "size": 3,
        "title": "Top 10 Assets with Unpatched Critical/High Vulnerabilities",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "barchart"
      },
      "customWidth": "34",
      "name": "query - unpatched assets"
    },
    {
      "type": 1,
      "content": {
        "json": "### CVSS Score Analysis"
      },
      "name": "text - cvss header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "cveBusterVulnerabilities_CL\r\n| summarize Count = count() by bin(CVSS, 1.0)\r\n| order by CVSS asc",
        "size": 0,
        "title": "CVSS Score Distribution",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "barchart"
      },
      "customWidth": "50",
      "name": "query - cvss distribution"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "cveBusterVulnerabilities_CL\r\n| where CVSS >= 9.0\r\n| summarize Count = count(), AvgCVSS = avg(CVSS), MaxCVSS = max(CVSS) by MachineName\r\n| order by Count desc, AvgCVSS desc\r\n| take 10",
        "size": 0,
        "title": "Top 10 Assets with CVSS >= 9.0",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "table",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Count",
              "formatter": 8,
              "formatOptions": {
                "palette": "redBright"
              }
            },
            {
              "columnMatch": "AvgCVSS",
              "formatter": 8,
              "formatOptions": {
                "palette": "orange"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 1
                }
              }
            },
            {
              "columnMatch": "MaxCVSS",
              "formatter": 8,
              "formatOptions": {
                "palette": "red"
              },
              "numberFormat": {
                "unit": 0,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 1
                }
              }
            }
          ]
        }
      },
      "customWidth": "50",
      "name": "query - high cvss assets"
    },
    {
      "type": 1,
      "content": {
        "json": "### Recent Vulnerability Discoveries"
      },
      "name": "text - recent header"
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "cveBusterVulnerabilities_CL\r\n| where TimeGenerated > ago(7d)\r\n| summarize Count = count() by bin(TimeGenerated, 1d), Severity\r\n| order by TimeGenerated desc",
        "size": 0,
        "title": "New Vulnerabilities Detected (Last 7 Days)",
        "timeContext": {
          "durationMs": 0
        },
        "timeContextFromParameter": "TimeRange",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "barchart"
      },
      "name": "query - recent discoveries"
    }
  ],
  "fromTemplateId": "sentinel-cveBusterWorkbook",
  "styleSettings": {},
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}
